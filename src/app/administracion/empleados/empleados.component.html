<!-- <detalle-usuario *ngIf="usuarioSeleccionado" [usuario] ="usuarioSeleccionado"></detalle-usuario> -->
<div class="card border-primary mb-3">
  <div class="card-body text-primary">
    <p-messages [value]="msgs" class="col-6 align-self-center" [closable]="true" [showTransitionOptions]="'10ms'"
      [hideTransitionOptions]="'0ms'"></p-messages>
    <h5 class="card-title">Administrar Empleados</h5>
    <p-toolbar styleClass="p-mb-4">
      <ng-template pTemplate="left">
        <button pButton pRipple label="Nuevo" icon="pi pi-plus" class="p-button-success p-mr-2"
          (click)="openNewEmpleado()" *ngIf="authService.hasRole('ROLE_ADMIN')"></button>
      </ng-template>

      <ng-template pTemplate="right">
        <p-fileUpload mode="basic" accept="image/*" [maxFileSize]="1000000" label="Import" chooseLabel="Importar"
          class="p-mr-2 p-d-inline-block"></p-fileUpload>
        <button pButton pRipple label="Exportar" (click)="exportAsXLSX()" icon="pi pi-upload"
          class="p-button-help"></button>
      </ng-template>
    </p-toolbar>

    <div *ngIf="usuarios?.length == 0" class="alert alert-info">
      No hay registros en la base de datos!
    </div>
    <p-table #dt [value]="empleados" dataKey="idEmpleado" [showCurrentPageReport]="true" [rows]="10"
      [totalRecords]="totalRecords" [loading]="loading" styleClass="p-datatable-customers" [rowHover]="true"
      [paginator]="true" (onLazyLoad)="loadCarsLazyT($event)" [filterDelay]="0"
      [globalFilterFields]="['persona.nombre','persona.apellido','persona.email']">

      <ng-template pTemplate="caption">
        <div class="p-d-flex p-ai-center p-jc-between">
          <h5 class="p-m-0">Listado Empleados</h5>
          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')"
              placeholder="Buscar..." />
          </span>
        </div>
      </ng-template>
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th style="width: 5%;">#</th>
          <th pSortableColumn="persona.nombre" style="width: 20%;">Nombre <p-sortIcon field="nombre">
            </p-sortIcon>
          </th>
          <th pSortableColumn="persona.apellidos" style="width: 25%;">Apellidos <p-sortIcon field="apellido">
            </p-sortIcon>
          </th>
          <th pSortableColumn="persona.email" style="width: 25%;">Correo <p-sortIcon field="email">
            </p-sortIcon>
          </th>
          <th style="width: 15%;" *ngIf="authService.hasRole('ROLE_ADMIN')">Acciones</th>
          <th style="width: 15%;" *ngIf="authService.hasRole('ROLE_ADMIN')">Usuario</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-rowData let-columns="columns">
        <tr [pSelectableRow]="rowData">
          <td>
            <img [src]="rowData.fotoLista" [alt]="rowData?.foto" class="img imgRedondaPerfil" *ngIf="rowData?.foto"
              style="width:40px; height: 40px;">

            <img (click)="abrirModal(usuario)" *ngIf="!rowData?.foto" src="http://localhost:8080/images/no-usuario.png"
              alt="Sin foto" class="imgRedondaLista" style="width:40px; height: 40px; cursor: pointer;">
          </td>
          <td>{{rowData.persona.nombre}}</td>
          <td>{{rowData.persona.apellidos}}</td>
          <td>{{rowData.persona.email}}</td>
          <td *ngIf="authService.hasRole('ROLE_ADMIN')">
            <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success p-mr-2"
              (click)="editarEmpleado(rowData)" *ngIf="authService.hasRole('ROLE_ADMIN')"></button>
            <button pButton pRipple icon="pi pi-copy" class="p-button-rounded p-button-secondary"
              (click)="eliminarUsuario(rowData)" *ngIf="authService.hasRole('ROLE_ADMIN')"></button>
          </td>
          <td *ngIf="authService.hasRole('ROLE_ADMIN')">
            <button pButton pRipple icon="pi pi-user-edit" class="p-button-rounded p-button-info p-mr-2"
              (click)="editarUsuario(rowData)" *ngIf="authService.hasRole('ROLE_ADMIN')"></button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="summary">
        <div class="p-d-flex p-ai-center p-jc-between">
          Existen en total {{empleados ? empleados.length : 0 }} empleados.
        </div>
      </ng-template>
    </p-table>
  </div>
  <p-dialog [(visible)]="empleadoDialog" [style]="{width: '650px'}" header="Detalle del Empleado" [modal]="true"
    (onHide)="limpiarPasswords()" styleClass="p-fluid" [maximizable]="true" [baseZIndex]="10000" [draggable]="true"
    [resizable]="true">
    <p-messages [value]="msgs2" key="modal-message" class="col-6 align-self-center" [closable]="true"
      [showTransitionOptions]="'10ms'" [hideTransitionOptions]="'0ms'"></p-messages>
    <ng-template pTemplate="content" style="height: 700px !important;">

      <div class="p-fluid p-formgrid p-grid">
        <div class="p-field p-col">
          <label for="nombre">Nombre</label>
          <input type="text" pInputText id="nombre" [(ngModel)]="empleadoSeleccionado.persona.nombre" required
            autofocus />
          <small class="p-invalid" *ngIf="submitted && !empleadoSeleccionado.persona.nombre">Nombre es
            requerido.</small>
        </div>
        <div class="p-field p-col">
          <label for="apellido">Apellidos</label>
          <input type="text" pInputText id="apellido" [(ngModel)]="empleadoSeleccionado.persona.apellidos" required
            autofocus />
          <small class="p-invalid" *ngIf="submitted && !empleadoSeleccionado.persona.apellidos">Apellido es
            requerido.</small>
        </div>
      </div>
      <div class="p-fluid p-formgrid p-grid">
        <div class="p-field p-col">
          <label for="fechaInicio">Fecha Inicio</label>
          <p-calendar [(ngModel)]="empleadoSeleccionado.fechaInicio" [locale]="es"  dateFormat="mm/dd/yy"  [showIcon]="true"
          [monthNavigator]="true" [yearNavigator]="true" yearRange="2015:2030"></p-calendar>
          <small class="p-invalid" *ngIf="submitted && !empleadoSeleccionado.fechaInicio">Fecha Inicio es
            requerido.</small>
        </div>
        <div class="p-field p-col">
          <label for="fechaFin">Fecha Fin</label>
          <p-calendar [(ngModel)]="empleadoSeleccionado.fechaFin" [locale]="es"  dateFormat="mm/dd/yy"  [showIcon]="true"
            [monthNavigator]="true" [yearNavigator]="true" yearRange="2015:2030"></p-calendar>
          <small class="p-invalid" *ngIf="submitted && !empleadoSeleccionado.fechaFin">Fecha Fin es requerido.</small>
        </div>
      </div>
      <div class="p-fluid p-formgrid p-grid">
        <div class="p-field p-col">
          <label for="email">Correo</label>
          <input type="text" pInputText id="email" [(ngModel)]="empleadoSeleccionado.persona.email" required
            autofocus />
          <small class="p-invalid" *ngIf="submitted && !empleadoSeleccionado.persona.email">Correo es
            requerido.</small>
        </div>
        <div class="p-field p-col">
          <label for="cargo">Cargo</label>
          <p-dropdown inputId="cargo" [options]="cargos" [(ngModel)]="empleadoSeleccionado.cargo" optionLabel="nombre"
            placeholder="Seleccione el Cargo"></p-dropdown>
          <small class="p-invalid" *ngIf="submitted && !empleadoSeleccionado.persona.email">Cargo es
            requerido.</small>
        </div>
      </div>      
      <div class="p-fluid p-formgrid p-grid">
        <div class="p-field p-col">
          <label for="pais">Pais</label>
          <p-dropdown inputId="pais" [options]="paises" [(ngModel)]="empleadoSeleccionado.pais" optionLabel="nombre"
            placeholder="Seleccione el pais"></p-dropdown>
          <small class="p-invalid" *ngIf="submitted && !empleadoSeleccionado.pais">Pais es
            requerido.</small>
        </div>
        <div class="p-field p-col">
          <label for="tipoSalario">Tipo Salario</label>
          <p-dropdown inputId="tipoSalario" [options]="tiposSalario" [(ngModel)]="empleadoSeleccionado.tipoSalario"
            (onChange)="onChangeTipoSalario($event)" placeholder="Tipo Salario"></p-dropdown>
          <small class="p-invalid" *ngIf="submitted && !empleadoSeleccionado.persona.email">Tipo Salario es
            requerido.</small>
        </div>
      </div>
      <div class="p-fluid p-formgrid p-grid">
        <div class="p-field p-col">
          <label for="salario">Salario</label>
          <p-inputNumber id="salario" [(ngModel)]="empleadoSeleccionado.salario" inpudId="locale-us"
            [disabled]="empleadoSeleccionado.tipoSalario == 2" required autofocus mode="decimal" locale="en-US"
            [minFractionDigits]="2"></p-inputNumber>
          <small class="p-invalid"
            *ngIf="submitted && empleadoSeleccionado.salario < 1 && empleadoSeleccionado.tipoSalario == '1'">Salario es
            requerido.</small>
        </div>
        <div class="p-field p-col">
          <label for="monto">Monto por hora</label>
          <p-inputNumber id="monto" [(ngModel)]="empleadoSeleccionado.montoHora" inpudId="locale-us" mode="decimal"
            required autofocus [disabled]="empleadoSeleccionado.tipoSalario == 1" locale="en-US"
            [minFractionDigits]="2"></p-inputNumber>
          <small class="p-invalid"
            *ngIf="submitted && empleadoSeleccionado.montoHora < 1 && empleadoSeleccionado.tipoSalario == '2'">Monto por
            hora es requerido.</small>
        </div>
      </div>      
    </ng-template>

    <ng-template pTemplate="footer">
      <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text"
        (click)="hideDialogEmpleado()"></button>
      <button pButton pRipple label="Guardar" icon="pi pi-check" class="p-button-text"
        (click)="salvarEmpleado()"></button>
    </ng-template>
  </p-dialog>


  <!-- ////MODAL DE usuarioSeleccionado -->

  <p-dialog [(visible)]="usuarioDialog" [style]="{width: '650px'}" header="Detalle del Usuario" [modal]="true"
    (onHide)="limpiarPasswords()" styleClass="p-fluid" [maximizable]="true" [baseZIndex]="10000" [draggable]="true"
    [resizable]="true">
    <p-messages [value]="msgs2" key="modal-message" class="col-6 align-self-center" [closable]="true"
      [showTransitionOptions]="'10ms'" [hideTransitionOptions]="'0ms'"></p-messages>
    <ng-template pTemplate="content" style="height: 700px !important;">

      <img [src]="retrievedImage" class="img imgRedondaPerfil" *ngIf="empleadoSeleccionado.foto" style="width:50px; height: 50px; margin-left: 45%;">
      <div style="margin-left: 40%; margin-bottom: 20px;">
        <p-fileUpload mode="basic" name="myfile[]" chooseLabel="Subir Foto" customUpload="true" multiple="multiple"
          (uploadHandler)="subirFoto($event)" accept="image/*"></p-fileUpload>
      </div>


      <div class="p-fluid p-formgrid p-grid">
        <div class="p-field p-col">
          <label for="usuario">Usuario</label>
          <input type="text" pInputText id="usuario" [(ngModel)]="usuarioSeleccionado.username" required />
          <small class="p-invalid" *ngIf="submitted && !usuarioSeleccionado.username">Usuario es requerido.</small>
        </div>

        <div class="p-field p-col">
          <label>Contraseña</label>
          <input type="password" [(ngModel)]="usuarioSeleccionado.password" required autofocus style="width: 88%"
            [disabled]="usuarioSeleccionado.id" promptLabel="Ingrese la contraseña" weakLabel="Debil"
            mediumLabel="Medio" strongLabel="Fuerte" [showPassword]="password" placeholder="Contraseña Actual"
            pPassword />
          <button *ngIf="password" type="button" pButton pRipple icon="pi pi-eye" styleClass="p-button-danger"
            (click)="showPassword()"></button>
          <button *ngIf="!password" type="button" pButton pRipple icon="pi pi-eye-slash" styleClass="p-button-danger"
            (click)="showPassword()"></button>
          <small class="p-invalid" *ngIf="submitted && !usuarioSeleccionado.password">Contraseña es requerida.</small>
        </div>
      </div>
      <div class="p-fluid p-formgrid p-grid">
        <div class="p-field p-col">
          <label for="email">Roles</label>
          <span class="p-float-label">
            <p-multiSelect inputId="multiselect" [options]="roles" [(ngModel)]="rolesSelected" optionLabel="nombre"
              [filter]="false"></p-multiSelect>
            <small class="p-invalid" *ngIf="submitted && rolesSelected.length == 0">Debe seleccionar al menos un
              role.</small>
          </span>
        </div>
        <div class="p-field p-col" style="margin-top: 30px; margin-top: 30px;">
          Habilitado
          <p-inputSwitch id="habilitado" [(ngModel)]="usuarioSeleccionado.enabled"></p-inputSwitch>
        </div>
      </div>

      <p-accordion *ngIf="usuarioSeleccionado.idUsuario">
        <p-accordionTab header="Cambiar Contrasena">
          <div class="p-inputgroup" style="margin-bottom: 5px;">
            <input type="password" [(ngModel)]="usuarioSeleccionado.actualPassword" promptLabel="Ingrese la contraseña"
              weakLabel="Debil" mediumLabel="Medio" strongLabel="Fuerte" placeholder="Contraseña Actual" pPassword
              [showPassword]="oldPassword" />
            <button *ngIf="oldPassword" type="button" pButton pRipple icon="pi pi-eye" styleClass="p-button-danger"
              (click)="showOldPassword()"></button>
            <button *ngIf="!oldPassword" type="button" pButton pRipple icon="pi pi-eye-slash"
              styleClass="p-button-danger" (click)="showOldPassword()"></button>
          </div>
          <div class="p-inputgroup" style="margin-bottom: 5px;">
            <input type="password" [(ngModel)]="usuarioSeleccionado.newPassword" promptLabel="Ingrese la contraseña"
              weakLabel="Debil" mediumLabel="Medio" strongLabel="Fuerte" placeholder="Nueva Contraseña" pPassword
              [showPassword]="newPassword" />
            <button *ngIf="newPassword" type="button" pButton pRipple icon="pi pi-eye" styleClass="p-button-danger"
              (click)="showNewPassword()"></button>
            <button *ngIf="!newPassword" type="button" pButton pRipple icon="pi pi-eye-slash"
              styleClass="p-button-danger" (click)="showNewPassword()"></button>
          </div>
          <div class="p-inputgroup">
            <input type="password" [(ngModel)]="usuarioSeleccionado.confirmNewPassword"
              promptLabel="Ingrese la contraseña" weakLabel="Debil" mediumLabel="Medio" strongLabel="Fuerte"
              placeholder="Repetir Contraseña" pPassword [showPassword]="confirmNewPassword" />
            <button *ngIf="confirmNewPassword" type="button" pButton pRipple icon="pi pi-eye"
              styleClass="p-button-danger" (click)="showNewConfirmPassword()"></button>
            <button *ngIf="!confirmNewPassword" type="button" pButton pRipple icon="pi pi-eye-slash"
              styleClass="p-button-danger" (click)="showNewConfirmPassword()"></button>
          </div>

        </p-accordionTab>
      </p-accordion>

    </ng-template>

    <ng-template pTemplate="footer">
      <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text"
        (click)="hideDialogUsuario()"></button>
      <button pButton pRipple label="Guardar" icon="pi pi-check" class="p-button-text"
        (click)="salvarUsuario()"></button>
    </ng-template>
  </p-dialog>

  <p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>
</div>